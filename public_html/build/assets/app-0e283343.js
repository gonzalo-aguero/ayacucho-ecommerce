const A=window.DEBUG||!1,p={GOOGLE_REVIEWS:"/api/google-reviews",PRODUCTS:"/json/Productos.json",PAYMENT_METHODS:"/json/MetodosDePago.json",SHIPPING_ZONES:"/json/ZonasDeEnvio.json",VARIATIONS:"/json/Variaciones.json"},I=window.location.origin,T=21;class P extends Error{constructor(t,e="UNKNOWN_ERROR",r=null){super(t),this.name="AppError",this.code=e,this.details=r,this.timestamp=new Date}}function l(s,t=""){return A&&console.error(`[${t}] Error:`,s),s}function O(s,t=""){A&&console.warn(`[${t}] Warning:`,s)}function v(s,t=""){A&&console.log(`[${t}] Info:`,s)}class R{constructor(){this.content=[],this.load()}add(t,e=1,r){try{if(!t||!t.id)throw new Error("Invalid product data");if(e=parseInt(e),e<=0)throw new Error("Units must be greater than 0");const n=this.findCartItem(t.id,r);return n?n.units+=e:this.content.push({productId:t.id,units:e,option:r}),this.save(),!0}catch(n){return l(n,"Cart.add"),!1}}findCartItem(t,e){return this.content.find(r=>r.productId===t&&r.option===e)}get content(){return this.content}getUnits(t,e){try{const r=this.findCartItem(t,e);return r?r.units:0}catch(r){return l(r,"Cart.getUnits"),0}}remove(t,e){try{const r=this.content.findIndex(n=>n.productId===t.productId&&n.option===e);return r!==-1?(this.content.splice(r,1),this.save(),!0):!1}catch(r){return l(r,"Cart.remove"),!1}}clear(){this.content=[],this.save()}save(){try{const e=T*86400,r=new Date(new Date().getTime()+e*1e3).toUTCString();document.cookie=`cart=${JSON.stringify(this.content)}; expires=${r}; max-age=${e}; path=/; SameSite=Lax`}catch(t){l(t,"Cart.save")}}load(){try{if(document.cookie.split(";").some(e=>e.includes("cart"))){let e=document.cookie.split(";").find(r=>r.startsWith("cart=")?!0:!!r.startsWith(" cart="));if(e){e=e.trim().startsWith("cart=")?e.slice(5):e.slice(6);const r=JSON.parse(e);this.content=r.map(n=>({productId:n.productId||n.pos,units:parseInt(n.units),option:n.option}))}}else this.save()}catch{O("Cart load failed, initializing empty cart","Cart.load"),this.save()}}length(){return this.content.length}total(t){try{if(typeof t!="function")throw new Error("getProductPrice function is required");let e=0;return this.content.forEach(r=>{const n=t(r.productId);n!==void 0&&(e+=n*r.units)}),e}catch(e){return l(e,"Cart.total"),0}}migrateLegacyFormat(t){try{this.content.forEach(e=>{if(e.pos!==void 0&&e.productId===void 0){const r=t[e.pos];r&&(e.productId=r.id,delete e.pos)}}),this.save()}catch(e){l(e,"Cart.migrateLegacyFormat")}}}class U{static squareMeters(t,e){try{if(typeof t!="number"||t<0)throw new Error("Units must be a non-negative number");if(!e||typeof e!="object")throw new Error("Product data is required");if(!e.m2ByUnit||typeof e.m2ByUnit!="number")throw new Error("Product must have m2ByUnit property");return(t*e.m2ByUnit).toFixed(2)}catch(r){return l(r,"StaticProduct.squareMeters"),"0.00"}}static productPage(t){try{if(!t||typeof t!="object")throw new Error("Product data is required");if(!t.name||!t.id)throw new Error("Product must have name and id properties");let e=`${I}/${t.name}/${t.id}`;return e=e.replace(/ /g,"-").toLowerCase(),e}catch(e){return l(e,"StaticProduct.productPage"),I}}static measurableInM2(t){try{return!t||typeof t!="object"?!1:t.m2Price!=null&&t.m2ByUnit!=null}catch(e){return l(e,"StaticProduct.measurableInM2"),!1}}static addToCart(t=1,e,r,n,o,c){try{if(typeof t!="number"||t<=0)return c&&c.invalidQuantity(),!1;if(!e||typeof e!="object")throw new Error("Product data is required");if(!n||typeof n.add!="function")throw new Error("Valid cart instance is required");if(!o||typeof o.getByValue!="function")throw new Error("Valid variations instance is required");if(!c)throw new Error("Notification service is required");if(this.canBeAdded(t,e,r,n,o)){const d=n.add(e,t,r);return d?c.addedToCart():c.cartError(),d}else return c.insufficientStock(),!1}catch(d){return l(d,"StaticProduct.addToCart"),c&&c.cartError(),!1}}static canBeAdded(t,e,r,n,o){try{if(!e||!n||!o)return!1;const c=n.getUnits(e.id,r);return this.validUnits(c+t,e,r,o)}catch(c){return l(c,"StaticProduct.canBeAdded"),!1}}static validUnits(t,e,r,n){try{if(!e||!n)return!1;const o=r&&r!==""&&e.variationId!==null;if(this.measurableInM2(e)){const c=e.m2ByUnit;if(o){const d=n.getByValue(e.variationId,r);return d&&t*c<=d.units}else return t*c<=e.units}else if(o){const c=n.getByValue(e.variationId,r);return c&&t<=c.units}else return t<=e.units}catch(o){return l(o,"StaticProduct.validUnits"),!1}}static maxAvailableUnits(t,e,r){try{if(!t||!r)return 0;const n=e&&e!=="";if(this.measurableInM2(t)){if(n){const o=r.getByValue(t.variationId,e);if(o&&t.m2ByUnit)return parseInt(parseFloat(o.units)/parseFloat(t.m2ByUnit))}else if(t.m2ByUnit)return parseInt(parseFloat(t.units)/parseFloat(t.m2ByUnit))}else if(n){const o=r.getByValue(t.variationId,e);return o?o.units:0}else return t.units||0;return 0}catch(n){return l(n,"StaticProduct.maxAvailableUnits"),0}}}var C;(function(s){var t={soundsOff:!1,sounds:{success:"sounds/success, warning/1.mp3",warning:"sounds/success, warning/3.mp3",error:"sounds/errors/1.mp3"},animDuration:{success:4e3,warning:4e3,error:4e3}};Object.defineProperty(s,"Settings",{get:function(){return t},set:function(u){t.sounds=u.sounds||t.sounds,t.animDuration=u.animDuration||t.animDuration,t.soundsOff=u.soundsOff!=null?u.soundsOff:t.soundsOff}});function e(u,a){a===void 0&&(a=t.animDuration.error),d("error",u,a,c("error"))}s.Error=e;function r(u,a){a===void 0&&(a=t.animDuration.success),d("success",u,a,c("success"))}s.Success=r;function n(u,a){a===void 0&&(a=t.animDuration.warning),d("warning",u,a,c("warning"))}s.Warning=n;function o(u){u.classList.remove("active"),u.classList.remove("success"),u.classList.remove("error"),u.addEventListener("transitionend",function(a){var h=a.currentTarget.parentNode;a.propertyName!="bottom"||h==null||(setTimeout(function(){var f=h.getElementsByClassName("component-notify").length;f===0&&h.remove()},0),a.currentTarget.remove())})}s.Close=o;function c(u){var a=document.createElement("div");a.className="component-notify";var h=document.createElement("div");h.className="--text";var f=document.createElement("div");f.className="--button-close",f.addEventListener("click",function(w){w.stopPropagation();var E=w.target.closest(".component-notify");o(E)}),a.addEventListener("click",function(w){w.stopPropagation();var E=w.target.closest(".component-notify");o(E)}),f.innerHTML="<span>&#10006;</span>",a.appendChild(h),a.appendChild(f);var m=document.getElementById("notify-container");if(m||(m=document.createElement("div"),m.id="notify-container",document.body.appendChild(m)),t.soundsOff){var g=document.createElement("audio"),b=t.sounds[u];g.autoplay="autoplay",g.onended=function(){this.remove()},g.className="notify-sound",g.innerHTML='<source src="'+b+'" type="audio/mpeg" /><embed hidden="true" autostart="true" loop="false" src="'+b+'" />',m.appendChild(g)}return m.insertAdjacentElement("afterBegin",a),a}function d(u,a,h,f){a=a||"«ñîîáùåíèå íå ïåðåäàíî»",f.closest("#notify-container");var m=f.getElementsByClassName("--text")[0];m.textContent=a,setTimeout(function(){f.classList.add("active"),f.classList.add(u)},0),h&&setTimeout(function(){s.Close(f)},h)}})(C||(C={}));const B=C;class y{static async fetch(t,e={}){try{const r=`${I}${t}`,n=await fetch(r,{headers:{"Content-Type":"application/json",...e.headers},...e});if(!n.ok)throw new P(`HTTP ${n.status}: ${n.statusText}`,"HTTP_ERROR",{status:n.status,url:r});return await n.json()}catch(r){throw r instanceof P?r:new P(`Failed to fetch from ${t}`,"FETCH_ERROR",{originalError:r.message,endpoint:t})}}static async get(t){return this.fetch(t)}static async post(t,e){return this.fetch(t,{method:"POST",body:JSON.stringify(e)})}}const S={getGoogleReviews:()=>y.get(p.GOOGLE_REVIEWS),getProducts:()=>y.get(p.PRODUCTS),getPaymentMethods:()=>y.get(p.PAYMENT_METHODS),getShippingZones:()=>y.get(p.SHIPPING_ZONES),getVariations:()=>y.get(p.VARIATIONS)};class V{constructor(){this.list=[]}async load(){try{const t=await S.getVariations();if(!Array.isArray(t))throw new Error("Invalid variations data format");return this.list=t,v(`Loaded ${this.list.length} variations`,"Variations.load"),!0}catch(t){return l(t,"Variations.load"),!1}}get(t){try{if(typeof t!="number"||t<=0)throw new Error("Variation ID must be a positive number");const e=t-1;return e>=0&&e<this.list.length?{...this.list[e]}:null}catch(e){return l(e,"Variations.get"),null}}getValues(t){try{if(typeof t!="number"||t<=0)throw new Error("Variation ID must be a positive number");const e=this.get(t);return!e||!Array.isArray(e.options)?[]:e.options.map(r=>r.value)}catch(e){return l(e,"Variations.getValues"),[]}}getByIndex(t){try{if(typeof t!="number"||t<0)throw new Error("Variation index must be a non-negative number");return t>=0&&t<this.list.length?{...this.list[t]}:null}catch(e){return l(e,"Variations.getByIndex"),null}}getByValue(t,e){try{if(typeof t!="number"||t<=0)throw new Error("Variation ID must be a positive number");if(typeof e!="string"||e.trim()==="")throw new Error("Option value must be a non-empty string");const r=this.get(t);if(!r||!Array.isArray(r.options))return null;const n=r.options.find(o=>o.value===e);return n?{...n}:null}catch(r){return l(r,"Variations.getByValue"),null}}getTexts(t){try{if(typeof t!="number"||t<=0)throw new Error("Variation ID must be a positive number");const e=this.get(t);return!e||!Array.isArray(e.options)?[]:e.options.map((r,n)=>({index:n,name:r.value,value:r.value,units:r.units||0}))}catch(e){return l(e,"Variations.getTexts"),[]}}getAll(){return this.list.map(t=>({...t}))}getCount(){return this.list.length}isLoaded(){return this.list.length>0}exists(t){try{if(typeof t!="number"||t<=0)return!1;const e=t-1;return e>=0&&e<this.list.length}catch(e){return l(e,"Variations.exists"),!1}}getAllOptionValues(){try{const t=[];return this.list.forEach(e=>{Array.isArray(e.options)&&e.options.forEach(r=>{r.value&&!t.includes(r.value)&&t.push(r.value)})}),t}catch(t){return l(t,"Variations.getAllOptionValues"),[]}}getByOptionValue(t){try{if(typeof t!="string"||t.trim()==="")throw new Error("Option value must be a non-empty string");return this.list.filter(e=>Array.isArray(e.options)&&e.options.some(r=>r.value===t)).map(e=>({...e}))}catch(e){return l(e,"Variations.getByOptionValue"),[]}}}function L(s){return"$"+new Intl.NumberFormat("de-DE").format(s)}function x(s){return new Intl.NumberFormat("de-DE").format(s)}function i(s,t){if(t===void 0)return Alpine.store(s);Alpine.store(s,t)}function N(s,t){const e=document.getElementById("aux_black_transparent_bg"),r=document.getElementById("confirm_modal"),n=r.querySelector("p");n.innerText=s;const o=r.querySelector(".confirm_btn");o.innerText="Confirmar";var c=r.querySelector(".cancel_btn");c.innerText="Cancelar",e.classList.replace("hidden","fixed"),r.classList.replace("hidden","fixed"),i("ConfirmVisible",!0);function d(){r.classList.replace("fixed","hidden"),e.classList.replace("fixed","hidden"),c.removeEventListener("click",u),o.removeEventListener("click",a),setTimeout(()=>{i("ConfirmVisible",!1)},500)}function u(){d(),t(!1)}c.addEventListener("click",u);function a(){d(),t(!0)}o.addEventListener("click",a)}function G(s){console.log(i("cart").length()),i("cart").length()===0?i("Notify").Warning("Su carrito está vacío.",1250):location.href=s}function _(){const s=[];let t,e,r;i("products").forEach(n=>{t=n.category,e=s.findIndex(o=>o.category===t),e===-1?(r={category:t,products:[]},r.products.push(n),s.push(r)):s[e].products.push(n)}),i("sortedProducts",s)}function $(s){let t=[],e;s!==!1?i("sortedProducts").forEach(r=>{e={category:r.category,products:[]},e.products=r.products.slice(0,s),t.push(e)}):i("productsToPrint",i("sortedProducts")),DEBUG&&console.log("Products To Print:",t),i("productsToPrint",i("sortedProducts"))}async function j(){await fetch(location.origin+"/json/Productos.json").then(s=>s.json()).then(s=>{i("products",s),i("productsLength",s.length),DEBUG&&console.log("Productos sin ordenar:",i("products")),_(),i("sortedProducts",i("sortedProducts")),DEBUG&&console.log("Productos ordenados:",i("sortedProducts")),$(i("printedProductsMax"))})}class M{constructor(){this.reviews=[],this.show=[],this.interval=null}async load(){try{const t=await S.getGoogleReviews();if(!Array.isArray(t))throw new Error("Invalid reviews data format");return this.reviews=t,this.initializeShowArray(),v(`Loaded ${this.reviews.length} reviews`,"GoogleReviews.load"),!0}catch(t){return l(t,"GoogleReviews.load"),!1}}initializeShowArray(){this.show=new Array(this.reviews.length).fill(!1)}getReviews(){return[...this.reviews]}getReview(t){return t>=0&&t<this.reviews.length?{...this.reviews[t]}:null}getCount(){return this.reviews.length}isLoaded(){return this.reviews.length>0}getShowStates(){return[...this.show]}setShowState(t,e){t>=0&&t<this.show.length&&(this.show[t]=Boolean(e))}showReview(t){t>=0&&t<this.show.length&&(this.show.fill(!1),this.show[t]=!0)}hideAllReviews(){this.show.fill(!1)}startRotation(t=6e3){if(this.interval&&this.stopRotation(),this.reviews.length===0){v("No reviews to rotate","GoogleReviews.startRotation");return}this.showReview(0);let e=0;this.interval=setInterval(()=>{e=(e+1)%this.reviews.length,this.showReview(e)},t),v(`Started review rotation with ${t}ms interval`,"GoogleReviews.startRotation")}stopRotation(){this.interval&&(clearInterval(this.interval),this.interval=null,v("Stopped review rotation","GoogleReviews.stopRotation"))}getCurrentActiveIndex(){return this.show.findIndex(t=>t===!0)}destroy(){this.stopRotation(),this.reviews=[],this.show=[]}}async function k(){DEBUG&&console.log("THIS IS THE HOME PAGE."),i("googleReviews",new M),await i("googleReviews").load(),DEBUG&&console.log("REVIEWS: ",i("googleReviews").reviews)}function H(){DEBUG&&console.log("This is the Product Page!"),i("selectedVariation",void 0)}DEBUG&&console.log("Code working");document.addEventListener("alpine:init",async function(){i("products",[]),i("variations",new V),i("productsLength",0),i("sortedProducts",[]),i("productsToPrint",[]),i("printedProductsMax",!1),i("cart",new R),i("StaticProduct",U),i("Notify",B),i("cartOpened",!1),i("ConfirmVisible",!1),i("priceFormat",L),i("decimalFormat",x),i("Confirm",N),i("gotoCheckout",G),await j(),i("variations").load(),B.Settings={soundsOff:!1,animDuration:{success:3500,warning:3500,error:3500}};const s=window.location.pathname;s==="/"?k():s==="/checkout"?CHECKOUT():IS_PRODUCT_PAGE&&H()});
