var x=Object.defineProperty;var I=(s,e,t)=>e in s?x(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var h=(s,e,t)=>(I(s,typeof e!="symbol"?e+"":e,t),t);class S{constructor(){h(this,"content");this.content=[],this.load()}add(e,t=1){t=parseInt(t);const o=Alpine.store("products").findIndex(a=>a.id===e.id),r=this.content.findIndex(a=>a.pos===o);return r!==-1?this.content[r].units+=t:this.content.push({pos:o,units:t}),this.save(),!0}get content(){return this.content}getUnits(e){let t=!1;const o=Alpine.store("products").findIndex(r=>r.id===e);if(o!==-1){const r=this.content.findIndex(a=>a.pos===o);r!==-1?t=this.content[r].units:t=0}return t}remove(e){let t=!1;const o=this.content.findIndex(r=>r.pos===e.pos);return o!==-1&&(this.content.splice(o,1),this.save(),t=!0),t}clear(){this.content=[],this.save()}save(){const o=new Date(new Date().getTime()+18144e5).toUTCString();document.cookie=`cart=${JSON.stringify(this.content)}; expires=date-in-GMTString-format=${o}; path=/`}load(){if(document.cookie.split(";").some(t=>t.includes("cart"))){const t=document.cookie.split(";").find(r=>r.startsWith("cart=")).slice(5);let o=JSON.parse(t);o=o.map(r=>({pos:r.pos,units:parseInt(r.units)})),this.content=o}else this.save()}length(){return this.content.length}total(){let e=0;return this.content.forEach(t=>{const o=Alpine.store("products")[t.pos];e+=o.price*t.units}),e}}const v=class{constructor(e=[]){this.methods=e}get _methods(){return this.methods}set _methods(e=[]){this.methods=e}async load(){await fetch(v.api).then(e=>e.json()).then(e=>{this.methods=e})}getText(e){const t=e.percent;let o;return t===0?o=e.name:t<0?o=e.name+" ( "+t+"% de descuento )":t>0&&(o=e.name+" ( "+t+"% de recargo )"),o}texts(){let e=[];for(let t=0;t<this.methods.length;t++)e[t]={name:this.getText(this.methods[t])};return e}applyPercent(e,t){const o=t.percent;let r;return o===0?r=e:o<0?r=e*(1-o/100):o>0&&(r=e*(1+o/100)),r}};let m=v;h(m,"api",location.origin+"/json/MetodosDePago.json");class E{static squareMeters(e,t){return e>=0?(e*t.m2ByUnit).toPrecision(3):0}static productPage(e){let t=location.origin+"/"+e.name+"/"+e.id;return t=t.replace(/ /g,"-").toLowerCase(),t}static measurableInM2(e){return e.m2Price!=null&&e.m2ByUnit!=null}static addToCart(e,t){let o=!1;if(e>0){const r=Alpine.store("cart").getUnits(t.id);let a=!0;if(E.measurableInM2(t)){const f=t.m2ByUnit;a=r*f+e*f<=t.units}else a=r+e<=t.units;a?Alpine.store("cart").add(t,e)?(Alpine.store("Notify").Success("Agregado al carrito",1500),o=!0):Alpine.store("Notify").Error("Ha ocurrido un error al agregar al carrito",2e3):Alpine.store("Notify").Warning("No hay suficiente stock disponible.")}else Alpine.store("Notify").Warning("Debe agregar al menos una unidad",1500);return o}}const C=class{constructor(e=[]){this.zones=e}get _zones(){return this.zones}set _zones(e=[]){this.zones=e}async load(){await fetch(C.api).then(e=>e.json()).then(e=>{this.zones=e})}texts(){let e=[];for(let t=0;t<this.zones.length;t++)e[t]={name:this.zones[t].name+": $"+this.zones[t].cost};return e}};let g=C;h(g,"api",location.origin+"/json/ZonasDeEnvio.json");var y;(function(s){var e={soundsOff:!1,sounds:{success:"sounds/success, warning/1.mp3",warning:"sounds/success, warning/3.mp3",error:"sounds/errors/1.mp3"},animDuration:{success:4e3,warning:4e3,error:4e3}};Object.defineProperty(s,"Settings",{get:function(){return e},set:function(c){e.sounds=c.sounds||e.sounds,e.animDuration=c.animDuration||e.animDuration,e.soundsOff=c.soundsOff!=null?c.soundsOff:e.soundsOff}});function t(c,i){i===void 0&&(i=e.animDuration.error),P("error",c,i,f("error"))}s.Error=t;function o(c,i){i===void 0&&(i=e.animDuration.success),P("success",c,i,f("success"))}s.Success=o;function r(c,i){i===void 0&&(i=e.animDuration.warning),P("warning",c,i,f("warning"))}s.Warning=r;function a(c){c.classList.remove("active"),c.classList.remove("success"),c.classList.remove("error"),c.addEventListener("transitionend",function(i){var l=i.currentTarget.parentNode;i.propertyName!="bottom"||l==null||(setTimeout(function(){var d=l.getElementsByClassName("component-notify").length;d===0&&l.remove()},0),i.currentTarget.remove())})}s.Close=a;function f(c){var i=document.createElement("div");i.className="component-notify";var l=document.createElement("div");l.className="--text";var d=document.createElement("div");d.className="--button-close",d.addEventListener("click",function(w){w.stopPropagation();var O=w.target.closest(".component-notify");a(O)}),d.innerHTML="<span>&#10006;</span>",i.appendChild(l),i.appendChild(d);var u=document.getElementById("notify-container");if(u||(u=document.createElement("div"),u.id="notify-container",document.body.appendChild(u)),e.soundsOff){var p=document.createElement("audio"),T=e.sounds[c];p.autoplay="autoplay",p.onended=function(){this.remove()},p.className="notify-sound",p.innerHTML='<source src="'+T+'" type="audio/mpeg" /><embed hidden="true" autostart="true" loop="false" src="'+T+'" />',u.appendChild(p)}return u.insertAdjacentElement("afterBegin",i),i}function P(c,i,l,d){i=i||"«ñîîáùåíèå íå ïåðåäàíî»",d.closest("#notify-container");var u=d.getElementsByClassName("--text")[0];u.textContent=i,setTimeout(function(){d.classList.add("active"),d.classList.add(c)},0),l&&setTimeout(function(){s.Close(d)},l)}})(y||(y={}));const A=y;class U{constructor(){}total(){let e=0;const t=Alpine.store("cart").total();e+=t;const o=Alpine.store("selectedShippingZone");o!==void 0?e+=o.cost:console.log("Falta seleccionar la zona de envío.");const r=Alpine.store("selectedPaymentMethod");return r!==void 0?e=Alpine.store("paymentMethods").applyPercent(e,r):console.log("Falta seleccionar el método de pago."),e}}DEBUG&&console.log("Code working");function n(s,e){if(e===void 0)return Alpine.store(s);Alpine.store(s,e)}function M(s){return"$"+new Intl.NumberFormat("de-DE").format(s)}function D(s){return confirm(s)}function N(s){console.log(n("cart").length()),n("cart").length()===0?n("Notify").Warning("Su carrito está vacío.",1250):location.href=s}document.addEventListener("alpine:init",async function(){n("products",[]),n("productsLength",0),n("sortedProducts",[]),n("productsToPrint",[]),n("printedProductsMax",!1),n("cart",new S),n("StaticProduct",E),n("Notify",A),n("cartOpened",!1),n("priceFormat",M),n("Confirm",D),n("gotoCheckout",N),await L(),console.log("PRODUCTOS CARGADOS 2"),A.Settings={soundsOff:!1,animDuration:{success:5e3,warning:5e3,error:5e3}};const s=window.location.pathname;s==="/"?b():s==="/checkout"?j():IS_PRODUCT_PAGE&&z()});function B(){const s=[];let e,t,o;n("products").forEach(r=>{e=r.category,t=s.findIndex(a=>a.category===e),t===-1?(o={category:e,products:[]},o.products.push(r),s.push(o)):s[t].products.push(r)}),n("sortedProducts",s)}function G(s){let e=[],t;s!==!1?n("sortedProducts").forEach(o=>{t={category:o.category,products:[]},t.products=o.products.slice(0,s),e.push(t)}):n("productsToPrint",n("sortedProducts")),DEBUG&&console.log("Products To Print:",e),n("productsToPrint",n("sortedProducts"))}async function L(){await fetch(location.origin+"/json/Productos.json").then(s=>s.json()).then(s=>{n("products",s),n("productsLength",s.length),DEBUG&&console.log("Productos sin ordenar:",n("products")),B(),n("sortedProducts",n("sortedProducts")),DEBUG&&console.log("Productos ordenados:",n("sortedProducts")),G(n("printedProductsMax")),console.log("PRODUCTOS CARGADOS")})}function b(){console.log("THIS IS THE HOME PAGE.")}async function j(){console.log("THIS IS THE CHECKOUT PAGE."),n("selectedPaymentMethod",void 0),n("selectedShippingZone",void 0),n("paymentMethods",new m),n("shippingZones",new g),await n("paymentMethods").load(),DEBUG&&console.log("MÉTODOS DE PAGO: ",n("paymentMethods").methods),await n("shippingZones").load(),DEBUG&&console.log("ZONAS: ",n("shippingZones").zones),n("order",new U(n("cart"))),n("showSummary",()=>n("cart")!==void 0&&n("paymentMethods")!==void 0&&n("shippingZones")!==void 0)}function z(){console.log("This is the Product Page!")}
