var S=Object.defineProperty;var A=(o,e,t)=>e in o?S(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var f=(o,e,t)=>(A(o,typeof e!="symbol"?e+"":e,t),t);class x{constructor(){f(this,"content");this.content=[],this.load()}add(e,t=1){t=parseInt(t);const s=Alpine.store("products").findIndex(l=>l.id===e.id),c=this.content.findIndex(l=>l.pos===s);return c!==-1?this.content[c].units+=t:this.content.push({pos:s,units:t}),this.save(),!0}get content(){return this.content}remove(e){let t=!1;const s=this.content.findIndex(c=>c.pos===e.pos);return s!==-1&&(this.content.splice(s,1),this.save(),t=!0),t}clear(){this.content=[],this.save()}save(){const s=new Date(new Date().getTime()+18144e5).toUTCString();document.cookie=`cart=${JSON.stringify(this.content)}; expires=date-in-GMTString-format=${s};`}load(){if(document.cookie.split(";").some(t=>t.includes("cart"))){const t=document.cookie.split(";").find(c=>c.startsWith("cart=")).slice(5);let s=JSON.parse(t);s=s.map(c=>({pos:c.pos,units:parseInt(c.units)})),this.content=s}else this.save()}length(){return this.content.length}total(){let e=0;return this.content.forEach(t=>{const s=Alpine.store("products")[t.pos];e+=s.price*t.units}),e}}const v=class{constructor(e=[]){this.methods=e}get _methods(){return this.methods}set _methods(e=[]){this.methods=e}async load(){await fetch(v.api).then(e=>e.json()).then(e=>{this.methods=e})}getText(e){const t=e.percent;let s;return t===0?s=e.name:t<0?s=e.name+" ( "+t+"% de descuento )":t>0&&(s=e.name+" ( "+t+"% de recargo )"),s}texts(){let e=[];for(let t=0;t<this.methods.length;t++)e[t]={name:this.getText(this.methods[t])};return e}applyPercent(e,t){const s=t.percent;let c;return s===0?c=e:s<0?c=e*(1-s/100):s>0&&(c=e*(1+s/100)),c}};let h=v;f(h,"api","./json/MetodosDePago.json");class D{static squareMeters(e,t){return e>=0?(e*t.m2ByUnit).toPrecision(3):0}static productPage(e){let t="producto/"+e.name+"/"+e.id;return t=t.replace(/ /g,"-").toLowerCase(),t}static measurableInM2(e){return e.m2Price!=null&&e.m2ByUnit!=null}static addToCart({units:e},t){Alpine.store("cart").add(t,e)?(Alpine.store("Notify").Success("Agregado al carrito",1500),e=1):Alpine.store("Notify").Error("Ha ocurrido un error al agregar al carrito",2e3)}}const E=class{constructor(e=[]){this.zones=e}get _zones(){return this.zones}set _zones(e=[]){this.zones=e}async load(){await fetch(E.api).then(e=>e.json()).then(e=>{this.zones=e})}texts(){let e=[];for(let t=0;t<this.zones.length;t++)e[t]={name:this.zones[t].name+": $"+this.zones[t].cost};return e}};let m=E;f(m,"api","./json/ZonasDeEnvio.json");var P;(function(o){var e={soundsOff:!1,sounds:{success:"sounds/success, warning/1.mp3",warning:"sounds/success, warning/3.mp3",error:"sounds/errors/1.mp3"},animDuration:{success:4e3,warning:4e3,error:4e3}};Object.defineProperty(o,"Settings",{get:function(){return e},set:function(i){e.sounds=i.sounds||e.sounds,e.animDuration=i.animDuration||e.animDuration,e.soundsOff=i.soundsOff!=null?i.soundsOff:e.soundsOff}});function t(i,r){r===void 0&&(r=e.animDuration.error),y("error",i,r,g("error"))}o.Error=t;function s(i,r){r===void 0&&(r=e.animDuration.success),y("success",i,r,g("success"))}o.Success=s;function c(i,r){r===void 0&&(r=e.animDuration.warning),y("warning",i,r,g("warning"))}o.Warning=c;function l(i){i.classList.remove("active"),i.classList.remove("success"),i.classList.remove("error"),i.addEventListener("transitionend",function(r){var d=r.currentTarget.parentNode;r.propertyName!="bottom"||d==null||(setTimeout(function(){var a=d.getElementsByClassName("component-notify").length;a===0&&d.remove()},0),r.currentTarget.remove())})}o.Close=l;function g(i){var r=document.createElement("div");r.className="component-notify";var d=document.createElement("div");d.className="--text";var a=document.createElement("div");a.className="--button-close",a.addEventListener("click",function(T){T.stopPropagation();var O=T.target.closest(".component-notify");l(O)}),a.innerHTML="<span>&#10006;</span>",r.appendChild(d),r.appendChild(a);var u=document.getElementById("notify-container");if(u||(u=document.createElement("div"),u.id="notify-container",document.body.appendChild(u)),e.soundsOff){var p=document.createElement("audio"),w=e.sounds[i];p.autoplay="autoplay",p.onended=function(){this.remove()},p.className="notify-sound",p.innerHTML='<source src="'+w+'" type="audio/mpeg" /><embed hidden="true" autostart="true" loop="false" src="'+w+'" />',u.appendChild(p)}return u.insertAdjacentElement("afterBegin",r),r}function y(i,r,d,a){r=r||"«ñîîáùåíèå íå ïåðåäàíî»",a.closest("#notify-container");var u=a.getElementsByClassName("--text")[0];u.textContent=r,setTimeout(function(){a.classList.add("active"),a.classList.add(i)},0),d&&setTimeout(function(){o.Close(a)},d)}})(P||(P={}));const C=P;class I{constructor(){}total(){let e=0;const t=Alpine.store("cart").total();e+=t;const s=Alpine.store("selectedShippingZone");s!==void 0?e+=s.cost:console.log("Falta seleccionar la zona de envío.");const c=Alpine.store("selectedPaymentMethod");return c!==void 0?e=Alpine.store("paymentMethods").applyPercent(e,c):console.log("Falta seleccionar el método de pago."),e}}DEBUG&&console.log("Code working");function n(o,e){if(e===void 0)return Alpine.store(o);Alpine.store(o,e)}function M(o){return"$"+new Intl.NumberFormat("de-DE").format(o)}function B(o){return confirm(o)}function N(o){console.log(n("cart").length()),n("cart").length()===0?n("Notify").Warning("Su carrito está vacío.",1250):location.href=o}document.addEventListener("alpine:init",async function(){switch(n("products",[]),n("productsLength",0),n("sortedProducts",[]),n("productsToPrint",[]),n("printedProductsMax",!1),n("cart",new x),n("StaticProduct",D),n("Notify",C),n("cartOpened",!1),n("priceFormat",M),n("Confirm",B),n("gotoCheckout",N),await G(),console.log("PRODUCTOS CARGADOS 2"),C.Settings={soundsOff:!1,animDuration:{success:5e3,warning:5e3,error:5e3}},window.location.pathname){case"/":j();break;case"/checkout":z();break}});function L(){const o=[];let e,t,s;n("products").forEach(c=>{e=c.category,t=o.findIndex(l=>l.category===e),t===-1?(s={category:e,products:[]},s.products.push(c),o.push(s)):o[t].products.push(c)}),n("sortedProducts",o)}function U(o){let e=[],t;o!==!1?n("sortedProducts").forEach(s=>{t={category:s.category,products:[]},t.products=s.products.slice(0,o),e.push(t)}):n("productsToPrint",n("sortedProducts")),DEBUG&&console.log("Products To Print:",e),n("productsToPrint",n("sortedProducts"))}async function G(){await fetch("json/Productos.json").then(o=>o.json()).then(o=>{n("products",o),n("productsLength",o.length),DEBUG&&console.log("Productos sin ordenar:",n("products")),L(),n("sortedProducts",n("sortedProducts")),DEBUG&&console.log("Productos ordenados:",n("sortedProducts")),U(n("printedProductsMax")),console.log("PRODUCTOS CARGADOS")})}function j(){console.log("THIS IS THE HOME PAGE.")}async function z(){console.log("THIS IS THE CHECKOUT PAGE."),n("selectedPaymentMethod",void 0),n("selectedShippingZone",void 0),n("paymentMethods",new h),n("shippingZones",new m),await n("paymentMethods").load(),DEBUG&&console.log("MÉTODOS DE PAGO: ",n("paymentMethods").methods),await n("shippingZones").load(),DEBUG&&console.log("ZONAS: ",n("shippingZones").zones),n("order",new I(n("cart"))),n("showSummary",()=>n("cart")!==void 0&&n("paymentMethods")!==void 0&&n("shippingZones")!==void 0)}
